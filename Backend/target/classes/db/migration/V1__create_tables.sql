--quando o usuario resolve se cadastrar terá novos privelégios de analista
--por padrão existe usuários já cadastrados com perfil admin
CREATE TABLE usuario(
  nome VARCHAR(100) NOT NULL,
  id BIGINT GENERATED BY DEFAULT AS IDENTITY,
  email VARCHAR(255) NOT NULL UNIQUE,
  senha VARCHAR(255) NOT NULL,
  created TIMESTAMP DEFAULT NOW(),
  ativo BOOLEAN DEFAULT true,
  tipo VARCHAR(50) CHECK(tipo IN(
    'ADM', 'ANALISTA'
  )),
  PRIMARY KEY(id)
);

CREATE TABLE area_conhecimento(
  id BIGINT GENERATED BY DEFAULT AS IDENTITY,
  titulo VARCHAR(255) UNIQUE NOT NULL,
  descricao VARCHAR(255),
  PRIMARY KEY(id)
);

CREATE TABLE noticia(
  id BIGINT GENERATED BY DEFAULT AS IDENTITY,
  titulo VARCHAR(255) NOT NULL,
  resumo TEXT NOT NULL,
  url_original VARCHAR(500) NOT NULL,
  url_imagem VARCHAR(500),
  data_publicacao TIMESTAMP NOT NULL,
  data_coleta TIMESTAMP NOT NULL,
  fonte VARCHAR(255) NOT NULL,
  PRIMARY KEY(id)
);

CREATE TABLE termo_chave(
  id BIGINT GENERATED BY DEFAULT AS IDENTITY,
  termo VARCHAR(100),
  area_id BIGINT REFERENCES area_conhecimento(id),
  PRIMARY KEY(id)
);

CREATE TABLE noticia_area(
  noticia_id BIGINT REFERENCES noticia(id),
  area_conhecimento_id BIGINT REFERENCES area_conhecimento(id)
);

--Relacionamento de noticia e termo para buscas e pesquisas de acordo com o termo
CREATE TABLE noticia_termo (
  noticia_id BIGINT REFERENCES noticia(id),
  termo_id BIGINT REFERENCES termo_chave(id),
  PRIMARY KEY (noticia_id, termo_id)
);

-- indices para facilitar as pesquisas
CREATE INDEX idx_termo_chave_termo ON termo_chave(termo);
CREATE INDEX idx_area_titulo ON area_conhecimento(titulo);


