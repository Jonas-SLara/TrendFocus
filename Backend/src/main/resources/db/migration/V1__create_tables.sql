--quando o usuario resolve se cadastrar terá novos privelégios de analista
--por padrão existe usuários já cadastrados com perfil admin
CREATE TABLE usuario(
  nome VARCHAR(100) NOT NULL,
  id BIGINT GENERATED BY DEFAULT AS IDENTITY,
  email VARCHAR(255) NOT NULL UNIQUE,
  senha VARCHAR(255) NOT NULL,
  created TIMESTAMP DEFAULT NOW(),
  ativo BOOLEAN DEFAULT true,
  tipo VARCHAR(50) CHECK(tipo IN(
    'ROLE_ADM', 'ROLE_ANALISTA'
  )),
  PRIMARY KEY(id)
);

--TÓPICOS REPRESENTAM AS SUBÁREAS DENTRO DE CADA ÁREA DE CONHECIMENTO
--PODEM SER VISTAS COMO AS ÁREAS DE ATUAÇÃO DO PROFISSIONAL
CREATE TABLE topico(
  id BIGINT GENERATED BY DEFAULT AS IDENTITY,
  titulo VARCHAR(255) UNIQUE NOT NULL,
  descricao VARCHAR(255),
  area_conhecimento VARCHAR(50),
  PRIMARY KEY(id)
);

--NOTICIAS PRECISAM ENGLOBAR AO MENOS UMA ÁREA DE CONHECIMENTO E CONSEQUENTEMENTE
--PODEM COBRIR OU NÃO VÁRIOS TÓPICOS MAS UM É SEMPRE OBRIGATÓRIO, POR MEIO DE TERMOS
CREATE TABLE noticia(
  id BIGINT GENERATED BY DEFAULT AS IDENTITY,
  titulo VARCHAR(255) NOT NULL,
  resumo TEXT NOT NULL,
  url_original VARCHAR(500) NOT NULL,
  url_imagem VARCHAR(500),
  data_publicacao TIMESTAMP NOT NULL,
  data_coleta TIMESTAMP NOT NULL,
  fonte VARCHAR(255) NOT NULL,
  PRIMARY KEY(id)
);

--UM TERMO CHAVE É UMA PALAVRA OU UMA SEQUÊNCIA QUE PODE SER ENCAIXADA
--DENTRO DE UM TÓPICO E RELACIONADO A UMA ÁREA DE CONHECIMENTO CONSEQUENTEMENT
CREATE TABLE termo_chave(
  id BIGINT GENERATED BY DEFAULT AS IDENTITY,
  termo VARCHAR(100),
  id_topico BIGINT REFERENCES topico(id) ON DELETE CASCADE,
  PRIMARY KEY(id)
);

--UMA NOTÍCIA PODE ESTAR RELACIONADA A VÁRIOS TERMOS CHAVE E O OPOSTO ACONTECE
--ESSA RELAÇÃO É FUNDAMENTAL PARA O MECANISMO DE ANÁLISE DE TENDÊNCIAS E FILTRAGEM
CREATE TABLE noticia_termo (
  noticia_id BIGINT REFERENCES noticia(id) ON DELETE CASCADE,
  termo_id BIGINT REFERENCES termo_chave(id) ON DELETE CASCADE,
  PRIMARY KEY (noticia_id, termo_id)
);

--ÁREA DE ÍNDICES
CREATE INDEX idx_termo_chave_termo ON termo_chave(termo);
CREATE INDEX idx_topico_titulo ON topico(titulo);